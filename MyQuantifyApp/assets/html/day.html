<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人量化数据日报</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>

    <style>
        /* 1. 整体布局适应 1200px 宽度 */
        body {
            font-family: Arial, sans-serif;
            margin: 20px auto; /* 居中 */
            max-width: 1200px; /* 限制最大宽度 */
            background-color: #f4f7f6;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        /* 仪表盘 */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr); /* 6 列均分 */
            gap: 20px;
            margin-bottom: 40px;
        }
        .dashboard-item {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 15px 10px; /* 调整内边距适应 6 栏 */
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80px; /* 保持一致性 */
        }
        .dashboard-item .icon {
            font-size: 28px; /* 调整图标大小 */
            margin-bottom: 5px;
            color: #3498db;
        }
        .dashboard-item .label {
            font-size: 13px; /* 调整标签大小 */
            color: #7f8c8d;
            margin-bottom: 3px;
        }
        .dashboard-item .value {
            font-size: 20px; /* 调整数值大小 */
            font-weight: bold;
            color: #2c3e50;
        }
        .dashboard-item .unit {
            font-size: 11px;
            color: #7f8c8d;
            margin-left: 3px;
        }

        /* 图表区 */
        .content-area {
            display: flex;
            gap: 20px;
        }
        .left-panel {
            flex: 3; /* 75% 宽度 */
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .right-panel {
            flex: 1; /* 25% 宽度 */
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .chart-container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #34495e;
            text-align: center;
        }
        .chart-placeholder {
            flex-grow: 1; 
            min-height: 350px;
        }
    </style>
</head>
<body>

    <div class="dashboard-grid" id="data-cards">
        <div class="dashboard-item" id="card-total-time">
            <i class="icon fas fa-clock" style="color:#2ecc71;"></i>
            <div class="label">总使用时间</div>
            <div class="value">--<span class="unit">小时</span></div>
        </div>
        <div class="dashboard-item" id="card-work-time">
            <i class="icon fas fa-briefcase" style="color:#3498db;"></i>
            <div class="label">工作时间</div>
            <div class="value">--<span class="unit">小时</span></div>
        </div>
        <div class="dashboard-item" id="card-game-time">
            <i class="icon fas fa-gamepad" style="color:#e74c3c;"></i>
            <div class="label">游戏时间</div>
            <div class="value">--<span class="unit">小时</span></div>
        </div>
        <div class="dashboard-item" id="card-afk-time">
            <i class="icon fas fa-mug-hot" style="color:#f39c12;"></i>
            <div class="label">AFK时间</div>
            <div class="value">--<span class="unit">小时</span></div>
        </div>
        <div class="dashboard-item" id="card-typing-count">
            <i class="icon fas fa-keyboard" style="color:#8e44ad;"></i>
            <div class="label">打字数</div>
            <div class="value">--<span class="unit">千字</span></div>
        </div>
        <div class="dashboard-item" id="card-copy-count">
            <i class="icon fas fa-copy" style="color:#1abc9c;"></i>
            <div class="label">复制数</div>
            <div class="value">--<span class="unit">千字</span></div>
        </div>
    </div>

    <div class="content-area">
        <div class="left-panel">
            <div class="chart-container" style="flex-grow: 1;">
                <div class="chart-title">24小时打字与复制趋势</div>
                <div id="mixed-chart" class="chart-placeholder"></div>
            </div>
        </div>
        <div class="right-panel">
            <div class="chart-container">
                <div class="chart-title">今日时间占比</div>
                <div id="pie-chart-1" class="chart-placeholder"></div>
            </div>
            <div class="chart-container">
                <div class="chart-title">今日应用占比</div>
                <div id="pie-chart-2" class="chart-placeholder"></div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // 全局 ECharts 实例引用
        let myChartMixed, myChart1, myChart2;
        const charts = [];

        // =======================================================
        // C# 调用接口
        // =======================================================

        /**
         * C# 调用此函数来更新整个仪表盘的数据。
         * @param {object} data - 包含所有图表和卡片数据的JS对象。
         * * 示例数据结构 (C# 传入的 JSON 字符串反序列化后):
         * {
         * "cards": {
         * "totalTime": 8.5, "workTime": 5.2, "gameTime": 1.5, "afkTime": 1.8, 
         * "typingCount": 12.5, "copyCount": 3.4 
         * },
         * "mixedChart": {
         * "typingData": [1.2, 0.8, ... (24个值)],
         * "copyData": [0.5, 0.3, ... (24个值)]
         * },
         * "timePie": [
         * {"value": 5.2, "name": "工作"}, {"value": 1.5, "name": "游戏"}, 
         * {"value": 1.8, "name": "休息"}, {"value": 15.5, "name": "睡眠/其他"}
         * ],
         * "appPie": [
         * {"value": 30, "name": "VS Code"}, {"value": 25, "name": "Chrome"}, 
         * {"value": 15, "name": "WeChat"}, {"value": 30, "name": "其他"}
         * ]
         * }
         */
        function updateDashboard(data) {
            if (!data) return;

            // 1. 更新顶部卡片
            updateCards(data.cards);

            // 2. 更新混合图 (24小时趋势)
            if (myChartMixed && data.mixedChart) {
                updateMixedChart(data.mixedChart.typingData, data.mixedChart.copyData);
            }

            // 3. 更新时间占比饼图
            if (myChart1 && data.timePie) {
                updatePieChart1(data.timePie);
            }

            // 4. 更新应用占比饼图
            if (myChart2 && data.appPie) {
                updatePieChart2(data.appPie);
            }
        }

        // =======================================================
        // 辅助更新函数
        // =======================================================

        function updateCards(cards) {
            document.querySelector('#card-total-time .value').innerHTML = 
                `${cards.totalTime ? cards.totalTime.toFixed(1) : '--'}<span class="unit">小时</span>`;
            document.querySelector('#card-work-time .value').innerHTML = 
                `${cards.workTime ? cards.workTime.toFixed(1) : '--'}<span class="unit">小时</span>`;
            document.querySelector('#card-game-time .value').innerHTML = 
                `${cards.gameTime ? cards.gameTime.toFixed(1) : '--'}<span class="unit">小时</span>`;
            document.querySelector('#card-afk-time .value').innerHTML = 
                `${cards.afkTime ? cards.afkTime.toFixed(1) : '--'}<span class="unit">小时</span>`;
            document.querySelector('#card-typing-count .value').innerHTML = 
                `${cards.typingCount ? cards.typingCount.toFixed(1) : '--'}<span class="unit">千字</span>`;
            document.querySelector('#card-copy-count .value').innerHTML = 
                `${cards.copyCount ? cards.copyCount.toFixed(1) : '--'}<span class="unit">千字</span>`;
        }

        function updateMixedChart(typingData, copyData) {
            myChartMixed.setOption({
                series: [
                    { name: '打字数', data: typingData },
                    { name: '复制数', data: copyData }
                ]
            });
        }
        
        function updatePieChart1(newData) {
            myChart1.setOption({
                series: [{ data: newData }]
            });
        }
        
        function updatePieChart2(newData) {
            myChart2.setOption({
                series: [{ data: newData }]
            });
        }

        // =======================================================
        // ECharts 初始化 (保持原有的初始化逻辑，但使用新的数据结构和标题)
        // =======================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // 生成 24 小时刻度 (00时 - 23时)
            const hours = Array.from({length: 24}, (_, i) => `${i < 10 ? '0' + i : i}时`);
            
            // 默认的空数据
            const initialTypingData = Array(24).fill(0);
            const initialCopyData = Array(24).fill(0);
            const initialPieData = [];
            
            // --- 混合图初始化 ---
            var chartDomMixed = document.getElementById('mixed-chart');
            if (chartDomMixed) {
                myChartMixed = echarts.init(chartDomMixed);
                charts.push(myChartMixed);
                
                var optionMixed = {
                    tooltip: { trigger: 'axis', axisPointer: { type: 'cross' } },
                    grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },
                    legend: { data: ['打字数', '复制数'], top: 'top' },
                    xAxis: [{ type: 'category', data: hours, axisPointer: { type: 'shadow' } }],
                    yAxis: [
                        { type: 'value', name: '打字数 (千字)', min: 0, axisLabel: { formatter: '{value} 千字' } },
                        { type: 'value', name: '复制数 (千字)', min: 0, axisLabel: { formatter: '{value} 千字' } }
                    ],
                    series: [
                        { name: '打字数', type: 'bar', data: initialTypingData },
                        { name: '复制数', type: 'line', yAxisIndex: 1, data: initialCopyData }
                    ]
                };
                myChartMixed.setOption(optionMixed);
            }

            // --- 饼图一：时间占比 (南丁格尔图) ---
            var chartDom1 = document.getElementById('pie-chart-1');
            if (chartDom1) {
                myChart1 = echarts.init(chartDom1);
                charts.push(myChart1);
                var option1 = {
                    tooltip: { trigger: 'item' },
                    legend: { top: 'bottom' },
                    series: [{
                        name: '时间占比', type: 'pie', 
                        radius: ['10%', '65%'], center: ['50%', '50%'],
                        roseType: 'area', itemStyle: { borderRadius: 8 },
                        data: initialPieData // 初始空数据
                    }]
                };
                myChart1.setOption(option1);
            }

            // --- 饼图二：应用占比 (圆环图) ---
            var chartDom2 = document.getElementById('pie-chart-2');
            if (chartDom2) {
                myChart2 = echarts.init(chartDom2);
                charts.push(myChart2);
                var option2 = {
                    tooltip: { trigger: 'item' },
                    legend: { top: '5%', left: 'center' },
                    series: [{
                        name: '应用占比', type: 'pie', 
                        radius: ['40%', '70%'], avoidLabelOverlap: false,
                        padAngle: 5, itemStyle: { borderRadius: 10 },
                        label: { show: false, position: 'center' },
                        emphasis: { label: { show: true, fontSize: 20, fontWeight: 'bold' } },
                        labelLine: { show: false },
                        data: initialPieData // 初始空数据
                    }]
                };
                myChart2.setOption(option2);
            }

            // 监听页面大小变化，使所有图表自适应
            window.addEventListener('resize', function() {
                charts.forEach(chart => chart.resize());
            });

            // 默认加载示例数据 (可选：方便在浏览器中调试)
            // const sampleData = {
            //     "cards": { "totalTime": 15.2, "workTime": 7.5, "gameTime": 2.1, "afkTime": 5.6, "typingCount": 45.3, "copyCount": 10.1 },
            //     "mixedChart": {
            //         "typingData": [0.5, 0.4, 0.3, 0.2, 0.1, 1.0, 3.5, 4.5, 5.0, 4.8, 3.0, 2.5, 1.8, 1.5, 2.0, 3.2, 4.0, 3.8, 2.9, 1.5, 1.0, 0.8, 0.6, 0.4],
            //         "copyData": [0.1, 0.1, 0.0, 0.0, 0.0, 0.2, 0.8, 1.2, 1.5, 1.4, 0.9, 0.7, 0.5, 0.4, 0.6, 0.9, 1.1, 1.0, 0.7, 0.4, 0.3, 0.2, 0.1, 0.1]
            //     },
            //     "timePie": [
            //         {"value": 7.5, "name": "工作时间"}, {"value": 2.1, "name": "游戏时间"}, 
            //         {"value": 5.6, "name": "AFK时间"}, {"value": 8.8, "name": "其他/未记录"}
            //     ],
            //     "appPie": [
            //         {"value": 35, "name": "IDE/编辑器"}, {"value": 30, "name": "浏览器"}, 
            //         {"value": 20, "name": "通讯工具"}, {"value": 15, "name": "游戏/其他"}
            //     ]
            // };
            // updateDashboard(sampleData);
        });
    </script>
</body>
</html>