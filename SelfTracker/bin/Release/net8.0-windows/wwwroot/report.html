<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>数据分析报告</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .controls {
            text-align: center;
            margin-bottom: 30px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .chart-item {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            background-color: #fcfcfc;
        }

        .chart-placeholder {
            width: 100%;
            height: 300px;
        }
        /* 所有图表的高度 */
        label {
            margin-right: 10px;
            font-weight: bold;
            color: #555;
        }

        input[type="date"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        button {
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

            button:hover {
                background-color: #0056b3;
            }
    </style>
</head>
<body>
    <div class="container">
        <h1>个人活动统计报告</h1>

        <div class="controls">
            <label for="startDate">开始日期:</label>
            <input type="date" id="startDate">
            <label for="endDate" style="margin-left: 20px;">结束日期:</label>
            <input type="date" id="endDate">
            <button onclick="fetchDataAndRenderCharts()" style="margin-left: 20px;">查询</button>
        </div>

        <div class="chart-grid">
            <div class="chart-item">
                <h3 style="text-align: center; color: #444;">1. 每日生产力趋势 (打字与复制)</h3>
                <div id="productivityChart" class="chart-placeholder"></div>
            </div>
            <div class="chart-item">
                <h3 style="text-align: center; color: #444;">2. 每日 AFK 时间变化</h3>
                <div id="afkChart" class="chart-placeholder"></div>
            </div>
            <div class="chart-item">
                <h3 style="text-align: center; color: #444;">3. 每日非 AFK (活跃) 时间变化</h3>
                <div id="activeTimeChart" class="chart-placeholder"></div>
            </div>
            <div class="chart-item">
                <h3 style="text-align: center; color: #444;">4. 耗时最多的进程 (总时长)</h3>
                <div id="topProcessesChart" class="chart-placeholder"></div>
            </div>
        </div>
    </div>

    <script>
        // 初始化日期选择器
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');

        // 设置默认日期为最近7天
        const today = new Date();
        const sevenDaysAgo = new Date(today);
        sevenDaysAgo.setDate(today.getDate() - 7);

        startDateInput.value = sevenDaysAgo.toISOString().split('T')[0];
        endDateInput.value = today.toISOString().split('T')[0];

        // 初始化 ECharts 实例
        const productivityChart = echarts.init(document.getElementById('productivityChart'));
        const afkChart = echarts.init(document.getElementById('afkChart'));
        const activeTimeChart = echarts.init(document.getElementById('activeTimeChart'));
        const topProcessesChart = echarts.init(document.getElementById('topProcessesChart'));

        function generateMockData(days) {
            const data = {
                dates: [],
                keystrokes: [],
                copyCounts: [],
                afkDurations: [], // 单位：小时
                activeDurations: [], // 单位：小时
                topProcesses: []
            };

            const today = new Date();
            for (let i = 0; i < days; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                data.dates.unshift(date.toISOString().split('T')[0]); // 从远到近排序

                // 模拟数据
                data.keystrokes.unshift(Math.floor(Math.random() * 50000) + 10000);
                data.copyCounts.unshift(Math.floor(Math.random() * 200) + 50);
                data.afkDurations.unshift(parseFloat((Math.random() * 4 + 1).toFixed(1))); // 1-5小时
                data.activeDurations.unshift(parseFloat((Math.random() * 6 + 4).toFixed(1))); // 4-10小时
            }

            // 模拟进程数据 (只模拟一次，或者可以根据日期范围动态生成)
            data.topProcesses = [
                { name: 'VS Code', value: Math.floor(Math.random() * 15 + 5) },
                { name: 'Chrome', value: Math.floor(Math.random() * 10 + 3) },
                { name: 'WeChat', value: Math.floor(Math.random() * 5 + 1) },
                { name: 'Explorer', value: Math.floor(Math.random() * 3 + 1) },
                { name: 'Terminal', value: Math.floor(Math.random() * 4 + 1) },
                { name: 'Slack', value: Math.floor(Math.random() * 3 + 1) }
            ];

            return data;
        }

        // 渲染图表的函数
        function renderCharts(data) {
            // 1. 每日生产力趋势 (打字与复制)
            productivityChart.setOption({
                tooltip: { trigger: 'axis' },
                legend: { data: ['打字数量', '复制数量'] },
                xAxis: { type: 'category', data: data.dates },
                yAxis: [{ type: 'value', name: '打字数量' }, { type: 'value', name: '复制数量', axisLabel: { formatter: '{value}'} }],
                series: [
                    { name: '打字数量', type: 'line', smooth: true, data: data.keystrokes },
                    { name: '复制数量', type: 'line', smooth: true, yAxisIndex: 1, data: data.copyCounts }
                ]
            });

            // 2. 每日 AFK 时间变化
            afkChart.setOption({
                tooltip: { trigger: 'axis', formatter: '{b}<br/>{a}: {c} 小时' },
                xAxis: { type: 'category', data: data.dates },
                yAxis: { type: 'value', name: 'AFK 时间 (小时)' },
                series: [{
                    name: 'AFK 时间',
                    type: 'bar', // 可以是 bar 或 line
                    data: data.afkDurations,
                    itemStyle: { color: '#ff7043' }
                }]
            });

            // 3. 每日非 AFK (活跃) 时间变化
            activeTimeChart.setOption({
                tooltip: { trigger: 'axis', formatter: '{b}<br/>{a}: {c} 小时' },
                xAxis: { type: 'category', data: data.dates },
                yAxis: { type: 'value', name: '活跃时间 (小时)' },
                series: [{
                    name: '活跃时间',
                    type: 'bar', // 可以是 bar 或 line
                    data: data.activeDurations,
                    itemStyle: { color: '#4CAF50' }
                }]
            });

            // 4. 耗时最多的进程 (总时长)
            topProcessesChart.setOption({
                tooltip: { trigger: 'item', formatter: '{b}: {c} 小时 ({d}%)' },
                legend: { orient: 'vertical', left: 'left', data: data.topProcesses.map(item => item.name) },
                series: [{
                    name: '进程耗时',
                    type: 'pie',
                    radius: ['40%', '70%'],
                    avoidLabelOverlap: false,
                    label: {
                        show: false,
                        position: 'center'
                    },
                    emphasis: {
                        label: {
                            show: true,
                            fontSize: '20',
                            fontWeight: 'bold'
                        }
                    },
                    labelLine: { show: false },
                    data: data.topProcesses.map(item => ({ value: item.value, name: item.name }))
                }]
            });
        }

        function fetchDataAndRenderCharts() {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);

            // 计算天数差
            const diffTime = Math.abs(endDate - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // +1 包含结束日期

            if (isNaN(diffDays) || diffDays <= 0) {
                alert('请选择有效的日期范围！');
                return;
            }

            // 这里是模拟数据，实际中你需要通过 C# 提供的数据接口获取
            // 例如：
            // fetch('/api/getReportData?startDate=' + startDateInput.value + '&endDate=' + endDateInput.value)
            //     .then(response => response.json())
            //     .then(data => renderCharts(data));
            //
            // 或者，如果 C# 已经将数据注入到了全局变量中，直接使用
            const mockData = generateMockData(diffDays);
            renderCharts(mockData);
        }

        // 页面加载完成后立即渲染一次
        window.onload = fetchDataAndRenderCharts;

        // 窗口大小调整时，图表也调整
        window.addEventListener('resize', () => {
            productivityChart.resize();
            afkChart.resize();
            activeTimeChart.resize();
            topProcessesChart.resize();
        });

        // 这个函数是为C#调用准备的，如果需要从C#传递数据
        function updateCharts(jsonData) {
            const data = JSON.parse(jsonData);
            renderCharts(data);
        }
    </script>
</body>
</html>