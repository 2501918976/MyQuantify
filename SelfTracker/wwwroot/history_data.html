<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†å²æ•°æ®åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, sans-serif;
            background: transparent;
            padding: 16px;
            color: #2c3e50;
        }

        .container {
            max-width: 100%;
        }

        /* å¤´éƒ¨ï¼šæ ‡é¢˜å’Œæ—¥æœŸé€‰æ‹©åœ¨åŒä¸€è¡Œ */
        .header {
            background: white;
            border-radius: 10px;
            padding: 16px 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 20px;
            color: #2c3e50;
            margin: 0;
        }

        .date-selector {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .date-group {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .date-group label {
            font-size: 13px;
            color: #2c3e50;
            font-weight: 500;
        }

        .date-group input[type="date"] {
            padding: 6px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
            transition: border-color 0.3s;
        }

        .date-group input[type="date"]:focus {
            outline: none;
            border-color: #4e73df;
        }

        .btn-query {
            padding: 6px 24px;
            background: #4e73df;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-query:hover {
            background: #3c5fd1;
        }

        /* æ•°æ®å¡ç‰‡ï¼š4ä¸ªä¸€è¡Œï¼Œç´§å‡‘æ˜¾ç¤º */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        /* ä¿®æ”¹å¡ç‰‡ç½‘æ ¼é—´è· */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px; /* é—´è·ç¨å¾®ç¼©å° */
            margin-bottom: 12px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 10px 14px; /* å¤§å¹…ç¼©å°ä¸Šä¸‹å†…è¾¹è· */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 70px; /* å›ºå®šä¸€ä¸ªè¾ƒå°çš„é«˜åº¦ */
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 2px; /* ç´§è´´æ•°å€¼çº¿ */
        }

        .stat-icon {
            font-size: 14px; /* å›¾æ ‡ç¨å¾®ç¼©å° */
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            font-weight: 500;
        }

        /* æ•°å€¼å’Œè¶‹åŠ¿æ‰€åœ¨è¡Œ */
        .stat-value-container {
            display: flex;
            align-items: baseline;
            gap: 6px;
        }

        .stat-value {
            font-size: 20px; /* ç¨å¾®å‡å°å­—å·ä»¥é€‚åº”é«˜åº¦ */
            font-weight: 700;
            color: #2c3e50;
        }

        .stat-trend {
            font-size: 10px;
            font-weight: 600;
            padding: 1px 5px; /* æå…¶ç´§å‡‘çš„æ ‡ç­¾ */
            border-radius: 3px;
            line-height: 1.4;
        }

        /* ä¿®æ”¹å¡ç‰‡å†…å®¹å¸ƒå±€ */
        .stat-value-container {
            display: flex;
            align-items: baseline; /* åº•éƒ¨å¯¹é½ */
            gap: 8px; /* æ•°å€¼å’Œè¶‹åŠ¿ä¹‹é—´çš„é—´è· */
        }

        .stat-trend.up {
            background: #e8f5e9;
            color: #4caf50;
        }

        .stat-trend.down {
            background: #ffebee;
            color: #f44336;
        }

        .stat-trend.neutral {
            background: #f5f5f5;
            color: #9e9e9e;
        }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .chart-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }

        .controls-group {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn-group {
            display: flex;
            gap: 4px;
            background: #f5f5f5;
            padding: 4px;
            border-radius: 6px;
        }

        .btn-toggle {
            padding: 6px 14px;
            background: transparent;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-toggle.active {
            background: white;
            color: #4e73df;
            font-weight: 600;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-toggle:hover:not(.active) {
            color: #333;
        }

        #mainChart {
            width: 100%;
            height: 300px;
        }

        .label-text {
            font-size: 12px;
            color: #666;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ï¼šæ ‡é¢˜å’Œæ—¥æœŸé€‰æ‹©åœ¨åŒä¸€è¡Œ -->
        <div class="header">
            <h1>ğŸ“Š å†å²æ•°æ®åˆ†æ</h1>
            <div class="date-selector">
                <div class="date-group">
                    <label for="startDate">èµ·å§‹ï¼š</label>
                    <input type="date" id="startDate">
                </div>
                <div class="date-group">
                    <label for="endDate">ç»“æŸï¼š</label>
                    <input type="date" id="endDate">
                </div>
                <button class="btn-query" onclick="loadData()">æŸ¥è¯¢</button>
            </div>
        </div>

        <!-- æ•°æ®æ±‡æ€»å¡ç‰‡ï¼š4ä¸ªä¸€è¡Œ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">âŒ¨ï¸</span>
                    <span class="stat-label">æ‰“å­—æ•°</span>
                </div>
                <div class="stat-value-container">
                    <div class="stat-value" id="totalKeystrokes">0</div>
                    <span class="stat-trend up" id="keystrokesTrend">+0%</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">ğŸ“‹</span>
                    <span class="stat-label">å¤åˆ¶æ¬¡æ•°</span>
                </div>
                <div class="stat-value-container">
                    <div class="stat-value" id="totalCopies">0</div>
                    <span class="stat-trend up" id="copiesTrend">+0%</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">â°</span>
                    <span class="stat-label">å·¥ä½œæ—¶é—´</span>
                </div>
                <div class="stat-value-container">
                    <div class="stat-value" id="totalActiveTime">0h</div>
                    <span class="stat-trend up" id="activeTrend">+0%</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">ğŸ’¤</span>
                    <span class="stat-label">ç¦»å¼€æ—¶é—´</span>
                </div>
                <div class="stat-value-container">
                    <div class="stat-value" id="totalAfkTime">0h</div>
                    <span class="stat-trend down" id="afkTrend">-0%</span>
                </div>
            </div>
        </div>

        <!-- å›¾è¡¨åŒºåŸŸï¼šå¯åˆ‡æ¢æ•°æ®ç±»å‹å’Œå›¾è¡¨ç±»å‹ -->
        <div class="chart-container">
            <div class="chart-controls">
                <div class="chart-title" id="chartTitle">æ‰“å­—æ•°é‡å˜åŒ–è¶‹åŠ¿</div>
                <div class="controls-group">
                    <!-- æ•°æ®ç±»å‹åˆ‡æ¢ -->
                    <span class="label-text">æ•°æ®ç±»å‹ï¼š</span>
                    <div class="btn-group">
                        <button class="btn-toggle active" onclick="switchDataType('keystrokes')">æ‰“å­—</button>
                        <button class="btn-toggle" onclick="switchDataType('copies')">å¤åˆ¶</button>
                        <button class="btn-toggle" onclick="switchDataType('active')">å·¥ä½œ</button>
                        <button class="btn-toggle" onclick="switchDataType('afk')">ç¦»å¼€</button>
                    </div>

                    <!-- å›¾è¡¨ç±»å‹åˆ‡æ¢ -->
                    <span class="label-text" style="margin-left: 12px;">å›¾è¡¨ç±»å‹ï¼š</span>
                    <div class="btn-group">
                        <button class="btn-toggle active" onclick="switchChartType('line')">æŠ˜çº¿å›¾</button>
                        <button class="btn-toggle" onclick="switchChartType('bar')">æŸ±çŠ¶å›¾</button>
                    </div>
                </div>
            </div>
            <div id="mainChart"></div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–å›¾è¡¨
        const mainChart = echarts.init(document.getElementById('mainChart'));

        // å½“å‰çŠ¶æ€
        let currentDataType = 'keystrokes';
        let currentChartType = 'line';
        let chartData = {
            dates: [],
            keystrokes: [],
            copies: [],
            active: [],
            afk: []
        };

        // æ•°æ®ç±»å‹é…ç½®
        const dataTypeConfig = {
            keystrokes: {
                title: 'æ‰“å­—æ•°é‡å˜åŒ–è¶‹åŠ¿',
                color: '#FF9800',
                name: 'æ‰“å­—æ•°é‡',
                unit: ''
            },
            copies: {
                title: 'å¤åˆ¶æ¬¡æ•°å˜åŒ–è¶‹åŠ¿',
                color: '#4CAF50',
                name: 'å¤åˆ¶æ¬¡æ•°',
                unit: ''
            },
            active: {
                title: 'å·¥ä½œæ—¶é—´å˜åŒ–è¶‹åŠ¿',
                color: '#2196F3',
                name: 'å·¥ä½œæ—¶é—´',
                unit: 'å°æ—¶'
            },
            afk: {
                title: 'ç¦»å¼€æ—¶é—´å˜åŒ–è¶‹åŠ¿',
                color: '#E91E63',
                name: 'ç¦»å¼€æ—¶é—´',
                unit: 'å°æ—¶'
            }
        };

        // è®¾ç½®é»˜è®¤æ—¥æœŸèŒƒå›´
        function setDefaultDates() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const fifteenDaysAgo = new Date(today);
            fifteenDaysAgo.setDate(fifteenDaysAgo.getDate() - 15);

            document.getElementById('endDate').valueAsDate = yesterday;
            document.getElementById('startDate').valueAsDate = fifteenDaysAgo;
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // æ›´æ–°è¶‹åŠ¿æ˜¾ç¤º
        function updateTrend(elementId, trendValue) {
            const element = document.getElementById(elementId);
            const absValue = Math.abs(trendValue);
            const sign = trendValue > 0 ? '+' : '';

            element.textContent = `${sign}${trendValue.toFixed(1)}%`;

            if (trendValue > 5) {
                element.className = 'stat-trend up';
            } else if (trendValue < -5) {
                element.className = 'stat-trend down';
            } else {
                element.className = 'stat-trend neutral';
            }
        }

        // ä» C# æ¥æ”¶æ•°æ®å’Œè¶‹åŠ¿
        function updateCharts(dataJson, trendsJson) {
            const data = JSON.parse(dataJson);
            const trends = JSON.parse(trendsJson);

            // æå–æ•°æ®
            chartData.dates = data.map(d => d.Date);
            chartData.keystrokes = data.map(d => d.Keystrokes);
            chartData.copies = data.map(d => d.CopyCount);
            chartData.active = data.map(d => d.ActiveTimeHours);
            chartData.afk = data.map(d => d.AfkTimeHours);

            // æ›´æ–°æ±‡æ€»æ•°æ®
            const totalKeystrokes = chartData.keystrokes.reduce((a, b) => a + b, 0);
            const totalCopies = chartData.copies.reduce((a, b) => a + b, 0);
            const totalActive = chartData.active.reduce((a, b) => a + b, 0);
            const totalAfk = chartData.afk.reduce((a, b) => a + b, 0);

            document.getElementById('totalKeystrokes').textContent = totalKeystrokes.toLocaleString();
            document.getElementById('totalCopies').textContent = totalCopies.toLocaleString();
            document.getElementById('totalActiveTime').textContent = totalActive.toFixed(1) + 'h';
            document.getElementById('totalAfkTime').textContent = totalAfk.toFixed(1) + 'h';

            // æ›´æ–°è¶‹åŠ¿
            updateTrend('keystrokesTrend', trends.KeystrokesTrend || 0);
            updateTrend('copiesTrend', trends.CopiesTrend || 0);
            updateTrend('activeTrend', trends.ActiveTrend || 0);
            updateTrend('afkTrend', trends.AfkTrend || 0);

            // æ›´æ–°å›¾è¡¨
            renderChart();
        }

        // æ¸²æŸ“å›¾è¡¨
        function renderChart() {
            const config = dataTypeConfig[currentDataType];
            const data = chartData[currentDataType];

            const option = {
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const value = params[0].value;
                        const unit = config.unit;
                        return `${params[0].axisValue}<br/>${config.name}: ${value}${unit}`;
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: chartData.dates,
                    axisLabel: {
                        rotate: 0,
                        fontSize: 11
                    }
                },
                yAxis: {
                    type: 'value',
                    name: config.name + (config.unit ? `(${config.unit})` : ''),
                    nameTextStyle: {
                        fontSize: 12
                    }
                },
                series: [
                    {
                        name: config.name,
                        type: currentChartType,
                        data: data,
                        smooth: currentChartType === 'line',
                        itemStyle: { color: config.color },
                        areaStyle: currentChartType === 'line' ? {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: config.color + '4D' },
                                { offset: 1, color: config.color + '0D' }
                            ])
                        } : undefined
                    }
                ]
            };

            mainChart.setOption(option, true);
        }

        // åˆ‡æ¢æ•°æ®ç±»å‹
        function switchDataType(type) {
            currentDataType = type;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.controls-group .btn-group')[0].querySelectorAll('.btn-toggle').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // æ›´æ–°æ ‡é¢˜
            document.getElementById('chartTitle').textContent = dataTypeConfig[type].title;

            // é‡æ–°æ¸²æŸ“å›¾è¡¨
            renderChart();
        }

        // åˆ‡æ¢å›¾è¡¨ç±»å‹
        function switchChartType(type) {
            currentChartType = type;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.controls-group .btn-group')[1].querySelectorAll('.btn-toggle').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // é‡æ–°æ¸²æŸ“å›¾è¡¨
            renderChart();
        }

        // åŠ è½½æ•°æ®
        function loadData() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            if (!startDate || !endDate) {
                alert('è¯·é€‰æ‹©å®Œæ•´çš„æ—¥æœŸèŒƒå›´');
                return;
            }

            if (startDate > endDate) {
                alert('èµ·å§‹æ—¥æœŸä¸èƒ½æ™šäºç»“æŸæ—¥æœŸ');
                return;
            }

            // è°ƒç”¨ C# æ–¹æ³•åŠ è½½æ•°æ®
            if (window.external && window.external.LoadHistoryData) {
                window.external.LoadHistoryData(startDate, endDate);
            }
        }

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡ç»˜å›¾è¡¨
        window.addEventListener('resize', () => {
            mainChart.resize();
        });

        // é¡µé¢åŠ è½½æ—¶è®¾ç½®é»˜è®¤æ—¥æœŸå¹¶åŠ è½½æ¼”ç¤ºæ•°æ®
        window.onload = function() {
            setDefaultDates();
            loadDemoData();
        };

        // æ¼”ç¤ºæ•°æ®
        function loadDemoData() {
            const demoData = [];
            const today = new Date();

            for (let i = 15; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);

                demoData.push({
                    Date: formatDate(date),
                    Keystrokes: Math.floor(Math.random() * 3000) + 1500,
                    CopyCount: Math.floor(Math.random() * 150) + 40,
                    AfkTimeHours: parseFloat((Math.random() * 2.5 + 0.5).toFixed(1)),
                    ActiveTimeHours: parseFloat((Math.random() * 5 + 2).toFixed(1))
                });
            }

            const demoTrends = {
                KeystrokesTrend: (Math.random() * 30 - 10).toFixed(1),
                CopiesTrend: (Math.random() * 25 - 8).toFixed(1),
                ActiveTrend: (Math.random() * 20 - 5).toFixed(1),
                AfkTrend: (Math.random() * 15 - 10).toFixed(1)
            };

            updateCharts(JSON.stringify(demoData), JSON.stringify(demoTrends));
        }
    </script>
</body>
</html>
